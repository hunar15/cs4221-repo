<!doctype html>

<html>
	<head>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
		<link href="css/testJsPlumb.css" rel="stylesheet" type="text/css">
		<script type="text/javascript" src="js/jquery.jsPlumb-1.5.2.js "></script>
		<script type="text/javascript">
			
			jsPlumb.bind("ready", function() {
				//alert("Hello world!!");
				$("#sidebar").accordion({
					autoHeight: true,
					heightStyle: "content",
					collapsible: true
				});
				var i =4;
				$(".droppable1").draggable({
					helper : "clone",
					opacity : 0.5
				});

				$("#jsContainer").droppable({
			        accept: '.droppable1',
			        tolerance : 'pointer',
			        drop: function(event, ui) {
			        	var cloned = $(ui.draggable).clone(false).removeClass("ui-draggable");
			        	// I FEELZ THE POWERZ
			            //var cloned = "<div id=\"hun\" class=\"window container-drag\">"+
						//		"<strong>Science, Bitch</strong></div>";
			            
			            //alert(cloned.hasClass("droppable1"));

			            
			            cloned.removeClass("droppable1");
			            cloned.addClass("container-drag");
			            cloned.attr("id","someRandom");
			            
			            //if draggable element requires some properties
			            //popup a modal for those properties
			            //else append the clone to the container
			            $("#jsContainer").append(cloned);
			            $("#someRandom").css("left", event.clientX - $(event.target).offset().left);
                		$("#someRandom").css("top", event.clientY - $(event.target).offset().top);
			            /*jsPlumb.draggable($("#someRandom"),{
							containment : "parent"
						});*/
						jsPlumb.addEndpoint("someRandom", {
							endpoint : "Dot",
							anchor: ["Perimeter", { shape : "Square"} ],
							container: "someRandom"

						});
						jsPlumb.draggable("someRandom",{
							containment : "parent"
						});
						
					}
			    });
				jsPlumb.draggable($(".container-drag"),{
					containment : "parent"
				});		
				jsPlumb.Defaults.Container = $("#jsContainer");
				
				jsPlumb.addEndpoint($("#element1"), {
					endpoint : "Dot",
					anchor: ["Perimeter", { shape : "Square"} ]

				});
				jsPlumb.addEndpoint($("#element2"), {
					endpoint : "Dot",
					anchor: ["Perimeter", { shape : "Square"} ]

				});
				jsPlumb.connect({
				    source:"element1",
				    target:"element2",
				    paintStyle:{lineWidth:2,strokeStyle:'rgb(0,0,0)'},
				    anchor: ["Perimeter", { shape : "Diamond"} ],
				    endpoint : "Dot",
				    endpointStyle : { radius : 3},
				    connector : "Flowchart"
				});
				jsPlumb.connect({
				    source:"element3",
				    target:"element1",
				    paintStyle:{lineWidth:2,strokeStyle:'rgb(0,0,0)'},
				    anchor: ["Perimeter", { shape : "Diamond"} ],
				    endpoint : "Dot",
				    endpointStyle : { radius : 3},
				    connector : "Flowchart"
				});
				$('#addEntity').click(function (e) {
					var newEntity = "<div id=\"element"+i+"\" class=\"window\">"+
								"<strong>Hello"+i+"</strong></div>";

					
					
					$("#jsContainer").append((newEntity));

					jsPlumb.draggable($("#element"+i),{
						containment : "parent"
					});
					jsPlumb.addEndpoint("element"+i, {
						endpoint : "Dot",
						anchor: ["Perimeter", { shape : "Square"} ],
						container: "element"+i
					});
					i++;	
				});
			});
			
		</script>
		
	<head>

	<body>
		<div id="sidebar">
			<h2>Entities</h2>
			<div>
				<ul>
					<li>
						<div class="window droppable1">
							<strong>Entity, Bitch</strong>
						</div>
					</li>
				</ul>
			</div>
				
			<h2>Relations</h2>
			<div>
				<ul>
					<li>
						<div class="diamond droppable1">
							<div class="diamond-text">IS-A</div>
						</div>
					</li>
					<li>
						<div class="diamond droppable1">
							<div class="diamond-text">Union</div>
						</div>
					</li>
					<li>
						<div class="diamond droppable1">
							<div class="diamond-text">Intersection</div>
						</div>
					</li>
					<li>
						<div class="diamond droppable1">
							<div class="diamond-text">Regular Relation</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
		<div id="superContainer">
			<div id="jsContainer">
				<div id="element1" class="window container-drag">
					<strong>Hello</strong>
				</div>
				<div id="element2" class="window container-drag">
					<strong>Dog</strong>
				</div>
				<div id="element3" class="diamond container-drag">
					<div class="diamond-text">Hello huanr huarn</div>
				</div>

			</div>
		</div>
		
	</body>
</html>

