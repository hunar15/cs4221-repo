<!DOCTYPE html>
<html lang="en">

<head>
    <title>Perform database normalization at ease</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Splash and Coming Soon Page Effects with CSS3" />
    <meta name="keywords" content="coming soon, splash page, css3, animation, effect, web design" />
    <meta name="author" content="Codrops" />
    <link href="css/jquery-ui-1.10.3.custom.css" rel="stylesheet">
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="css/demo.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery.dropdown.css" />
    <link rel="stylesheet" type="text/css" href="css/style1.css" />
    <link href='http://fonts.googleapis.com/css?family=Unlock|Cookie' rel='stylesheet' type='text/css' />
    <script src="js/jquery-1.9.1.js"></script>
    <script src="js/jquery.dropdown.js"></script>
    <script src="js/jquery-ui-1.10.3.custom.js"></script>
    <script src="normalizer.js"></script>
    <script type='text/javascript' src='https://www.google.com/jsapi'></script>


    <script>
        var attributes_array = [];
        var leftString = "";
        var rightString = "";

        $(document).ready(function () {
            // Handler for .ready() called.
            var editattr = document.getElementById("edit-attr");
            editattr.style.display = "none";
            var editFD = document.getElementById("dsTable");
            editFD.style.display = "none";
            var editMVD = document.getElementById("MVDdsTable");
            editMVD.style.display = "none";
            var algo_container = document.getElementById("Algorithm-container");
            algo_container.style.display = "none";
            var output_text_container = document.getElementById("outtxt");
            outtxt.style.display = "none";
			var home_button_container = document.getElementById("home-button");
            home_button_container.style.display = "none";
			
        });

        google.load('visualization', '1', {
            packages: ['table']
        });
         //google.setOnLoadCallback(drawTable);

        function redirectER() {
            var url = "ER.html";
            $(location).attr('href', url);
        }
		
		function homepagereload()
		{
			location.reload();
		}


        $("#attributes").keyup(function (event) {
            if (event.keyCode == 13) {
                $("#generate-table").click();
            }
        });

        function List_Attributes() {
            /*
    var duplicate_attr_found = false;
    var my_attribute_list = document.getElementById("attributes").value;
    if(my_attribute_list)
    {
      console.log(my_attribute_list);
      var non_unique_attributes_array = my_attribute_list.split(',');
    
      $.each(non_unique_attributes_array, function(i, el){
        if($.inArray(el, attributes_array) === -1) 
        {
          attributes_array.push(el);
        }
        else
        {
          duplicate_attr_found = true;
        }
      });
      //console.log(attributes_array[1]);
    }
    else
    {
      alert("input attributes not recognized");
      console.log("attributes does not exist");
    }
    
    if(duplicate_attr_found == true)
    {
      $(function() {
    $( "#dialog-message" ).dialog({
      modal: true,
      buttons: {
        Ok: function() {
          $( this ).dialog( "close" );
        }
      }
    });
  });   
      //alert("duplicate attribute name found, the duplicate has been eliminated");
    } */

            addAttr(attributes_array);


            $('#header1').effect('fade');
            $('#header2').effect('fade');
            $('#header3').effect('fade');
            $('#header4').effect('fade');
            //hide everything
            //var element1 = document.getElementById('header1');
            //element1.style.display = 'none';

            //var element2 = document.getElementById('header2');
            //element2.style.display = 'none';

            //var element3 = document.getElementById('header3');
            //element3.style.display = 'none';

            //var element4 = document.getElementById('header4');
            //element4.style.display = 'none';


            //google chart api drawing

            var cssClassNames = {
                'headerRow': 'italic-darkblue-font large-font bold-font',
                'tableRow': 'bold-black-font large-font',
                'oddTableRow': 'beige-background bold-black-font large-font',
                'selectedTableRow': 'orange-background large-font',
                'hoverTableRow': '',
                'headerCell': 'gold-border',
                'tableCell': '',
                'rowNumberCell': 'underline-blue-font'
            };

            var options = {
                'showRowNumber': true,
                'allowHtml': true,
                'cssClassNames': cssClassNames
            };

            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Attributes in Relation');

            for (var i = 0; i < attributes_array.length; i++) {
                data.addRows([
                    [attributes_array[i]],

                ]);

            }

            var table = new google.visualization.Table(document.getElementById('table_div'));
            table.draw(data, options);


            // Every time the table fires the "select" event, it should call your
            // selectHandler() function.
            /*
google.visualization.events.addListener(table, 'select', selectHandler);

function selectHandler(e) {
  alert('A table row was selected');
}*/
            //alert(my_attribute_list);

            var editattr = document.getElementById("edit-attr");
            editattr.style.display = "block";
            var editFD = document.getElementById("dsTable");
            editFD.style.display = "block";
            var editMVD = document.getElementById("MVDdsTable");
            editMVD.style.display = "block";
            var algo_container = document.getElementById("Algorithm-container");
            algo_container.style.display = "block";
            var output_text_container = document.getElementById("outtxt");
            output_text_container.style.display = "block";
			var home_button_container = document.getElementById("home-button");
            home_button_container.style.display = "block";

        }


        function List_Attributes_edit() {
            var duplicate_attr_found = false;
            var my_attribute_list = document.getElementById("attributes_edit").value;
            if (my_attribute_list) {
                console.log(my_attribute_list);
                var non_unique_attributes_array = my_attribute_list.split(',');
                $.each(non_unique_attributes_array, function (i, el) {
                    if ($.inArray(el, attributes_array) === -1) {
                        attributes_array.push(el);
                    } else {
                        duplicate_attr_found = true;
                    }
                });
                //console.log(attributes_array[1]);
            } else {
                alert("input attributes not recognized");
                console.log("attributes does not exist");
            }

            if (duplicate_attr_found == true) {
                $(function () {
                    $("#dialog-message").dialog({
                        modal: true,
                        buttons: {
                            Ok: function () {
                                $(this).dialog("close");
                            }
                        }
                    });
                });
                //alert("duplicate attribute name found, the duplicate has been eliminated");

            }
            addAttr(attributes_array);

            //hide everything
            var element1 = document.getElementById('header1');
            element1.style.display = 'none';

            var element2 = document.getElementById('header2');
            element2.style.display = 'none';

            var element3 = document.getElementById('header3');
            element3.style.display = 'none';

            var element4 = document.getElementById('header4');
            element4.style.display = 'none';


            //google chart api drawing

            var cssClassNames = {
                'headerRow': 'italic-darkblue-font large-font bold-font',
                'tableRow': 'bold-black-font large-font',
                'oddTableRow': 'beige-background bold-black-font large-font',
                'selectedTableRow': 'orange-background large-font',
                'hoverTableRow': '',
                'headerCell': 'gold-border',
                'tableCell': '',
                'rowNumberCell': 'underline-blue-font'
            };

            var options = {
                'showRowNumber': true,
                'allowHtml': true,
                'cssClassNames': cssClassNames
            };

            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Attributes in Relation');

            for (var i = 0; i < attributes_array.length; i++) {
                data.addRows([
                    [attributes_array[i]],

                ]);

            }

            var table = new google.visualization.Table(document.getElementById('table_div'));
            table.draw(data, options);

            //alert(my_attribute_list);

            //var editattr = document.getElementById("edit-attr");
            //editattr.style.display = "block";
        }

        function deleteRow(btn) {
            var row = btn.parentNode.parentNode;
            if (row.parentNode.rows.length > 1) {
                row.parentNode.removeChild(row);
            } else {
                alert("cannot delete the only row in table");
            }
        }

        function addRow() {

            var referenceNodes = document.getElementById("FDtable").getElementsByTagName("tr");
            //-2 because last row is button row
            var referenceNode = referenceNodes[referenceNodes.length - 1];
            var newNode = referenceNode.cloneNode(true);
            referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
        }

        function addRowMVD() {

            console.log("adding MVD");
            var referenceNodes = document.getElementById("MVDtable").getElementsByTagName("tr");
            //-2 because last row is button row
            var referenceNode = referenceNodes[referenceNodes.length - 1];
            var newNode = referenceNode.cloneNode(true);
            referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);

        }


        function submit_FD_MVD() {

			var errorflag = false;
           console.log(attributes_array);
            var fdtable = document.getElementById('FDtable');
            for (var r = 1, n = fdtable.rows.length; r < n; r++) {

                var result = document.evaluate("//table[@id='FDtable']/tbody/tr[" + r + "]/td[1]", document, null, XPathResult.STRING_TYPE, null).stringValue;
                var leftFDString=result.trim();
                var leftFDArray = leftFDString.split(',');
                console.log(leftFDArray);
                result = document.evaluate("//table[@id='FDtable']/tbody/tr[" + r + "]/td[3]", document, null, XPathResult.STRING_TYPE, null).stringValue;
                rightFDString=result.trim();
                var rightFDArray = rightFDString.split(',');
                var leftFDResult = validateFD(leftFDArray);
                var rightFDResult = validateFD(rightFDArray);
                if (leftFDResult == -1 && rightFDResult == -1) {
                    leftString = leftFDString;
                    rightString = rightFDString;
                    insertFD(leftString, rightString, "0");
                } else {
                    if (leftFDResult != -1) {
                        /*    $(function() {
          $( "#dialog-message" ).dialog({
          modal: true,
            buttons: {
            Ok: function() {
            $( this ).dialog( "close" );
          }
            }
            });
            }); */		
						errorflag = true;
                        var newDiv = $(document.createElement('div'));
                        newDiv.html("wrong FD, element " + "<b>" + leftFDArray[leftFDResult] + "</b>" + " on LHS of FD is not within the relation");
                        newDiv.dialog();
                        console.log("wrong fd, element "+leftFDArray[leftFDResult]+" on LHS is not an attribute");
                    }

                    if (rightFDResult != -1) {
						errorflag = true;
                        var newDiv = $(document.createElement('div'));
                        newDiv.html("wrong FD, element " + "<b>" + rightFDArray[rightFDResult] + "</b>" + " on RHS of FD is not within the relation");
                        newDiv.dialog();
                        console.log("wrong fd, element "+leftFDArray[rightFDResult]+" on RHS is not an attribute");
                    }

                }
            }
            var mvdtable = document.getElementById('MVDtable');
            for (var r = 1, n = mvdtable.rows.length; r < n; r++) {
                result= document.evaluate("//table[@id='MVDtable']/tbody/tr[" + r + "]/td[1]", document, null, XPathResult.STRING_TYPE, null).stringValue
                var leftMVDString=result.trim();
                var leftMVDArray = leftMVDString.split(',');
                result = document.evaluate("//table[@id='MVDtable']/tody/tr[" + r + "]/td[3]", document, null, XPathResult.STRING_TYPE, null).stringValue;
                rightMVDString=result.trim();
                var rightMVDArray = rightMVDString.split(',');
                var leftMVDResult = validateFD(leftMVDArray);
                var rightMVDResult = validateFD(rightMVDArray);
                if (leftMVDResult == -1 && rightMVDResult == -1) {
                    leftString = leftMVDString;
                    rightString = rightMVDString;
                    insertFD(leftString, rightString, "0");
					
                } else {
                    if (leftFDResult != -1) {
						errorflag = true;
                        //console.log("wrong mvd, element "+leftMVDArray[leftMVDResult]+" on LHS is not an attribute");
                        var newDiv = $(document.createElement('div'));
                        newDiv.html("wrong MVD, element " + "<b>" + leftMVDArray[leftMVDResult] + "</b>" + " on LHS of MVD is not within the relation");
                        newDiv.dialog();
                    
                    }

                    if (rightFDResult != -1) {
						errorflag = true;
                        //console.log("wrong mvd, element "+leftMVDArray[rightMVDResult]+" on RHS is not an attribute");
                        var newDiv = $(document.createElement('div'));
                        newDiv.html("wrong MVD, element " + "<b>" + rightMVDArray[rightMVDResult] + "</b>" + " on RHS of MVD is not within the relation");
                        newDiv.dialog();
                    }

                }
            }
			
			if(errorflag == false)
			{
				 var newDiv = $(document.createElement('div'));
                 newDiv.html("Dependencies submitted successfully!");
                 newDiv.dialog();
			}
        }


        function validateFD(FD_array) {
            if (FD_array.length == 0)
                return -1;
            for (var i = 0; i < FD_array.length; i++) {
                var found = $.inArray(FD_array[i], attributes_array)
                if (found == -1)
                    return i;
            }
            return -1;
        }


        function secondNF() {
            $("#outtxt").text("Your result: 2NF is ").append("" + is2NF(getFDNo()));
        }

        function thirdNF() {
            $("#outtxt").text("Your result: 3NF is ").append("" + is3NF(getFDNo()));
        }

        function BCNF() {
            $("#outtxt").text("Your result: BCNF is ").append("" + isBCNF(getFDNo()));
        }

        function fourNF() {
            $("#outtxt").text("Your result: 4NF is ").append("" + is4NF(getFDNo(), getMVDNo()));
        }

        function generateKeys() {
            var keys = getKeys(closure(getFDNo()));
            var out = ""

            for (var i = keys.length - 1; i > 0; i--) {
                out += numToAttribute(keys[i]) + " },{ ";
            }
            out += numToAttribute(keys[i]);
            $("#outtxt").text("Your result:").append("\nThe keys are: { " + out + " }");
        }



        function bcnfDecomp() {
            $("#outtxt").text("Your result: ").append(BCNFDecomp(getFDNo()));
        }

        function bersteinAlgo() {
            console.log(getFDNo());
            $("#outtxt").text("Your result: ").append(Bernstein(getFDNo()));
        }
    </script>


</head>

<body>
    <div class="googlechart" id='table_div'></div>
    <div class="sp-input" id="edit-attr">
        <input type="text" id="attributes_edit" value="Put down attribute name separated by comma" onfocus="this.value='';" />
        <input type="submit" class="button2" value="Submit Schema" onclick="List_Attributes_edit();">
        <input type="submit" class="button2" value="Submit dependencies" onclick="submit_FD_MVD();">
    </div>

    <div id='dependency-container'>
        <div class='dependencyTable' id='dsTable'>

            <table id="FDtable" align="center">
                <thead class="ui-widget-header">
                    <tr>
                        <td>Left hand side attribute</td>
                        <td>&nbsp&nbsp&nbspdetermines&nbsp&nbsp&nbsp</td>
                        <td>Right hand side attribute</td>
                    </tr>
                    <tbody class="ui-widget-content">
                        <tr>
                            <td>
                                <div contenteditable="true" onclick="document.execCommand('selectAll',false,null)">Edit me! Separate attributes using comma</div>
                            </td>
                            <td>-></td>
                            <td>
                                <div contenteditable="true" onclick="document.execCommand('selectAll',false,null)">Edit me! Separate attributes using comma</div>
                            </td>
                            <td>
                                <input type="button" class="MyButton1" value="Delete" onclick="deleteRow(this)" />
                            </td>
                        </tr>
                        </tr>
                    </tbody>
            </table>

            <div class="wrapper">
                <button class="button2" id="addFDBtn" onclick="addRow()">Add new FD</button>
            </div>

        </div>​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​



        <div class='dependencyTable' id='MVDdsTable'>

            <table id="MVDtable" align="center">
                <thead class="ui-widget-header">
                    <tr>
                        <td>Left hand side attribute</td>
                        <td>multi determines</td>
                        <td>Right hand side attribute</td>
                    </tr>
                    <tbody class="ui-widget-content">
                        <tr>
                            <td>
                                <div contenteditable="true" onclick="document.execCommand('selectAll',false,null)">Edit me! Separate attributes using comma</div>
                            </td>
                            <td>-></td>
                            <td>
                                <div contenteditable="true" onclick="document.execCommand('selectAll',false,null)">Edit me! Separate attributes using comma</div>
                            </td>
                            <td>
                                <input type="button" class="MyButton1" value="Delete" onclick="deleteRow(this)" />
                            </td>
                        </tr>
                    </tbody>
            </table>

            <div class="wrapper">
                <button class="button2" id="addMVDBtn" onclick="addRowMVD()">Add new MVD</button>
            </div>

        </div>

    </div>


    <div id="output">
        <textarea id="outtxt" readonly="readonly" rows="10" cols="70">Provide us with dependencies information of the relation by filling the table on the left,click submit dependency button and then choose to perform test or normalization! You result will then appear here :)</textarea>
    </div>

	

    <div id="dialog-message" title="Duplicate attribute name detected" class="invisible">
        <p>
            <span class="ui-icon ui-icon-circle-check" style="float: left; margin: 0 7px 50px 0;"></span>

        </p>
        <p>
            Duplicate attribute name detected <b>and duplicates have been removed</b>.
        </p>
    </div>


    <div id="Algorithm-container">
        <div id="algorithms" style="width:150px;padding-top:0px;">
            <button style="width:150px;cursor:pointer;" class="button3" onclick="secondNF()">2NF Test</button>
            <button style="width:150px;cursor:pointer;" class="button3" onclick="thirdNF()">3NF Test</button>
            <button style="width:150px;cursor:pointer;" class="button3" onclick="BCNF()">BCNF Test</button>
            <button style="width:150px;cursor:pointer;" class="button3" onclick="fourNF()">4NF Test</button>
            <hr style="width:170px;">
            <button style="width:150px;cursor:pointer;" class="button3" onclick="bcnfDecomp()">BCNF</button>
            <button style="width:150px;cursor:pointer;" class="button3" onclick="bersteinAlgo()">Bernstein</button>

        </div>
    </div>
    </div>

	<div id ="home-button">
		<button class="button2" id="homepage-button" onclick="homepagereload();">Back to homepage</button>
	</div>

    <div class="container">
        <h1 class="main" id="header1">Provide us with attributes of your relation &amp; get it normalized!</h1>
        <div class="sp-container">
            <div class="sp-content">
                <div class="sp-row">
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                </div>
                <div class="sp-row sp-side-row">
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                </div>
                <div class="sp-row sp-content-row">
                    <h2>Design your database schema and get rid of all anomalies!</h2>
                    <h1 class="sp-title" id="header2"><em>Bernstein Algorithm</em> &more!</h1>
                </div>
                <div class="sp-row sp-side-row">
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                </div>
                <div class="sp-row">
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                    <span><img src="images/db.gif" /></span>
                </div>
                <div class="sp-arrow" id="header4"></div>
            </div>
            <div class="sp-side" id="header3">
                <h2>Give it a try now!</h2>
                <div class="sp-input">
                    <a href="#" data-dropdown="#dropdown-1">Select your preferred approach to perform DB design</a>
                </div>
            </div>
        </div>
    </div>

    <div id="dropdown-1" class="dropdown dropdown-tip">
        <ul class="dropdown-menu">
            <li><a onclick="redirectER();">Design with ER approach</a>
            </li>
            <li class="dropdown-divider"></li>
            <li><a href="javascript:List_Attributes();">Design with Normal approach</a>
            </li>
        </ul>
    </div>
</body>

</html>